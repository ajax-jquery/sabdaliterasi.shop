---
layout: null
permalink: /wp-admin/ebook-generator/
---
<!DOCTYPE html>
<html lang="id">
<!-- FADHEL -->
<head>
<script src="/assets/js/jquery-3.7.1.min.js"></script>
<script src="/wp-content/cdn/g/ajax-jquery/cdn.sophiainstitute.id/master/safelink/css/wcsafelink.js"></script>    
<script src="/wp-content/cdn/n/axios/1.7.9/dist/axios.min.js"></script>
<script>let Pu={Cr:"MBDRTNFJCAPOSQEIGWLHVYZUKXmbdrtnfjcaposqeigwlhvyzukx3508749216+/=",en:function(r){let e=Pu.Cr,t="",a=0;for(;a<r.length;){let h=r.charCodeAt(a++),c=r.charCodeAt(a++),n=r.charCodeAt(a++),o=h>>2,A=(3&h)<<4|c>>4,C=isNaN(c)?64:(15&c)<<2|n>>6,d=isNaN(n)?64:63&n;t+=e.charAt(o)+e.charAt(A)+e.charAt(C)+e.charAt(d)}return t},de:function(r){let e=Pu.Cr,t="",a=0;for(r=r.replace(/[^A-Za-z0-9\+\/\=]/g,"");a<r.length;){let h=e.indexOf(r.charAt(a++)),c=e.indexOf(r.charAt(a++)),n=e.indexOf(r.charAt(a++)),o=e.indexOf(r.charAt(a++)),A=h<<2|c>>4,C=(15&c)<<4|n>>2,d=(3&n)<<6|o;t+=String.fromCharCode(A),64!==n&&(t+=String.fromCharCode(C)),64!==o&&(t+=String.fromCharCode(d))}return t}};const Hm_Key="";
const IMAGES_Key="";
const username = '0SwMy7';
const repository = 'wp-conten';
const branch = 'file';
const accessToken =IMAGES_Key;
const myproxy ="https://sabdaliterasi.xyz/api/fetch/";
function fotofile(){$(".inputfoto").removeClass("d-none"),$(".inputfotourl").addClass("d-none")}function fotourl(){$(".inputfoto").addClass("d-none"),$(".inputfotourl").removeClass("d-none")}function showLoading(){document.getElementById("loading").style.display="flex"}function hideLoading(){document.getElementById("loading").style.display="none"}function convertGDriveLink(t){return myproxy+"https://drive.usercontent.google.com/download?export=download&id="+t.match(/\/d\/(.*?)\//)[1]}function base64Encode(t){for(var e="AMNFCVYXSEIBTGUPOKJHDWRZLQamnfcvyxseibtgupokjhdwrzlq4529367810+/=",o="",a=0;a<t.length;){var r=t.charCodeAt(a++),n=t.charCodeAt(a++),d=t.charCodeAt(a++),c=r>>2,i=(3&r)<<4|n>>4,p=(15&n)<<2|d>>6,s=63&d;isNaN(n)?p=s=64:isNaN(d)&&(s=64),o+=e.charAt(c)+e.charAt(i)+e.charAt(p)+e.charAt(s)}return o}function base64Encode1(t){for(var e="ECOSVMNWKYLJRGPXQHUTFDBZIAecosvmnwkyljrgpxqhutfdbzia3601849257+/=",o="",a=0;a<t.length;){var r=t.charCodeAt(a++),n=t.charCodeAt(a++),d=t.charCodeAt(a++),c=r>>2,i=(3&r)<<4|n>>4,p=(15&n)<<2|d>>6,s=63&d;isNaN(n)?p=s=64:isNaN(d)&&(s=64),o+=e.charAt(c)+e.charAt(i)+e.charAt(p)+e.charAt(s)}return o}function convertToSlug(t){return t.toLowerCase().replace(/[^\w ]+/g,"").replace(/ +/g,"-")}function convertToNewLinks(t){return t.replace("/blob/","/").replace("/master/","/file/").replace("/main/","/data/").replace("https://github.com/","https://sabdaliterasi.xyz/wp-content/cdn/g/")}function getFormattedTime(){let t=new Date,e=t.getFullYear(),o=String(t.getMonth()+1).padStart(2,"0"),a=String(t.getDate()).padStart(2,"0"),r=String(t.getHours()).padStart(2,"0"),n=String(t.getMinutes()).padStart(2,"0"),d=String(t.getSeconds()).padStart(2,"0"),c=-t.getTimezoneOffset(),i;return`${e}-${o}-${a} ${r}:${n}:${d} ${c>=0?"+":"-"}${String(Math.floor(Math.abs(c)/60)).padStart(2,"0")}${String(Math.abs(c)%60).padStart(2,"0")}`}

$(document).ready(function(){$("#link").on("input change focus keydown keypress keyup paste cut click",function(){var t=document.getElementById("link").value;t.startsWith("https://github.com/")?($("#customCheckbox").prop("checked",!0).prop("disabled",!0),$("#UploadToGit").prop("checked",!1).prop("disabled",!0)):t.startsWith("https://z-library.sk/") || t.indexOf("z-library") > -1 ?$("#customCheckbox").prop("checked",!0).prop("disabled",!0):t.startsWith("https://drive.google.com/")?$("#UploadToGit").prop("checked",!1).prop("disabled",!0):t.startsWith("https://id.scribd.com") || t.startsWith("https://www.scribd.com")?($("#customCheckbox").prop("checked",!0).prop("disabled",!0),$('#penting').removeClass('d-none')):($('#penting').addClass('d-none'),$("#customCheckbox").prop("disabled",!1),$("#UploadToGit").prop("disabled",!1))})});
</script>    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Konversi Link GDrive ke JSON</title>
    <link rel="stylesheet" href="/wp-content/cdn/n/bootstrap/5.3.2/dist/css/bootstrap.min.css">
    <style>
        body {
            padding: 20px;
        }.jsonOut{width:100%;height:720px}#description,#output{height:120px}.form-group{ margin-top: 0.5em; }#loading{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.6);backdrop-filter:blur(5px);z-index:9999;justify-content:center;align-items:center}.spinner{width:60px;height:60px;border:6px solid #f3f3f3;border-top:6px solid #3498db;border-radius:50%;animation:1s linear infinite spin}@keyframes spin{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}#loading-text{margin-top:20px;font-family:Arial,sans-serif;font-size:20px;color:#fff}
    </style>
</head>
<body>
<!-- Overlay Loading -->
<div id="loading">
<div class="spinner"></div>
 </div>    
    <div class="container">
        <h1>Konversi Link GDrive ke JSON</h1>
        <div class="form-group">
            <label for="link">Link Download:</label>
            <input type="url" class="form-control" name="link" id="link" placeholder="Masukkan link download">
        </div>
        <div class="form-group">
            <label for="title">Judul <span id="penting" style="color:red" class="d-none">(dibutuhkan)</span>:</label>
            <input type="text" name="judulbuku" class="form-control" id="title" placeholder="Masukkan judul">
        </div>
       <div class="form-check form-check-inline">
        <input class="form-check-input" type="checkbox" id="customCheckbox">
        <label class="form-check-label" for="customCheckbox">
            Download
        </label>
    </div>
    <div class="form-check form-check-inline">
        <input class="form-check-input" type="checkbox" id="UploadToGit">
        <label class="form-check-label" for="UploadToGit">
            Upload
        </label>
    </div> 
 <div id="chekbox">
<div class="form-check form-check-inline">
<input onclick="fotofile()" class="form-check-input" type="radio" name="inlineRadioOptions" id="inlineRadio1" value="file" checked="">
<label class="form-check-label" for="inlineRadio1">From File</label>
</div>
<div class="form-check form-check-inline">
<input onclick="fotourl()" class="form-check-input" type="radio" name="inlineRadioOptions" id="inlineRadio2" value="url">
<label class="form-check-label" for="inlineRadio2">From URL</label>
</div>
</div>
            <div class="form-group inputfoto">
            <input type="file" class="form-control" id="fileInput">
            
        </div>
         <div class="form-group inputfotourl d-none">
        <input type="url" class="form-control mt-2" id="urlInput" placeholder="Masukkan URL Gambar">
        </div>
        
<div class="form-group">
<label for="description">DESKRIPSI:</label>
<textarea class="form-control" id="description"></textarea>

     </div>        
        <div class="form-group">
        <button class="btn btn-primary" onclick="convert()">Konversi</button>
        </div>
        <p><strong>Permalink:</strong></p>
        <p id="perma"></p>
<div class="form-group">
<label for="output">SHARE-WA:</label>
<textarea class="form-control" id="output" readonly></textarea>

     </div>
<div class="form-group"><p id="shareWa"></p></div>
<div class="form-group">
<label for="title">JSON:</label>
<textarea class="form-control jsonOut" id="jsonOut" readonly></textarea>
        </div>
    </div>


    <script src="/wp-content/cdn/n/bootstrap/5.3.2/dist/js/bootstrap.min.js"></script>
    <script>

async function convert() {
showLoading();
          const checkbox = document.getElementById('customCheckbox');
          const UploadToGit = document.getElementById('UploadToGit');
          const inlineRadio1 = document.getElementById('inlineRadio1');
          const inlineRadio2 = document.getElementById('inlineRadio2');
           const fileInput = document.getElementById('fileInput').files[0];
           const urlInput = document.getElementById('urlInput').value;
           const jsonOut = document.getElementById('jsonOut');
           let link = document.getElementById("link").value.replace("id.z-","z-");
           let title = document.getElementById("title").value,description = "";
           
           if(document.getElementById("description").value){
description=`---
         ${document.getElementById("description").value}

---`;  
           }
           
           let finallink=link,
            mode="Baca",
            caption=`*BACA EBOOK*
Judul: ${title}
${description}
Baca segerah: https://m.sabdaliterasi.xyz/download/ebook-${convertToSlug(title)}.pdf

> Karena GRATIS, maka untuk mendapatkan *Link Google Drive* harus melewati beberapa proses termasuk melihat IKLAN. *Kami sarankan agar menggunakan Google Chrome.*

===

> Setelah mendapatkan *Link Google Drive*, silahkan simpan baik-baik linknya, agar Anda bisa membacanya dikemudian hari tanpa melalui proses awal.

*Plus Note:*
_Silahkan Subscribe Channel Whatsapp *Sabda Literasi* agar tidak ketinggalan untuk mendapatkan Ebook gratis dan bahan bacaan menarik lainnya._
`;
  let hasilJSON;
  if(!link){
  alert("Link Wajib Diisi");hideLoading();
  return
  }
  else if(!title){
  alert("Judul Wajib Diisi");hideLoading();
  return
  }
  else if(inlineRadio1.checked){
  if(!fileInput){
  alert("File Wajib Diupload");hideLoading();
  return
  }
  }
  else if(inlineRadio2.checked){
  if(!urlInput){
  alert("URL File Wajib Diisi");hideLoading();
  return
  }
  };
    
            
            if (checkbox.checked) {
                        let finallink1;
            if(link.startsWith('https://github.com/')){
            finallink1 = convertToNewLinks(link)
                  
            }
            else if(link.startsWith('https://drive.google.com/')){
            
            finallink1 =convertGDriveLink(link)
            
            }
           else {
           
           if(UploadToGit.checked){        
    try {
        let convertlibrary;
        let retryCount = 0;
        const maxRetries = 3; // Batas maksimal percobaan

        do {
            convertlibrary = await libraryToGitHub(link);

            if (convertlibrary && convertlibrary.directUrl) {
                const hasExtension = /\.(pdf|epub|jpg|png|docx|txt)$/i.test(convertlibrary.directUrl);
                if (hasExtension) {
                    finallink1 = convertToNewLinks(convertlibrary.directUrl);
                    title = convertlibrary.namafile;
                    break;
                }
            }

            retryCount++;
        } while (retryCount < maxRetries);

        if (!convertlibrary || !convertlibrary.directUrl || retryCount >= maxRetries) {
            alert("Gagal mengkonversi Link setelah beberapa percobaan");
            hideLoading();
            return;
        }
    } 
    catch (error) {
        alert("Gagal mengkonversi Link");
        hideLoading();
        console.error('Error during link conversion:', error);
        return;
    }
    }
           else{               
           
           try {
        let convertlibraryy;
        let retryCountt = 0;
        const maxRetriess = 3; // Batas maksimal percobaan

        do {
            convertlibraryy = await getName(link);
            
           

            if (convertlibraryy) {
                const hasExtension = /\.(pdf|epub|jpg|png|docx|txt)$/i.test(convertlibraryy);
                if (hasExtension) {
                    finallink1 = myproxy+link;
                    title = convertlibraryy.replace(/\.(pdf|epub|jpg|png|docx|txt)$/i, '');
                    break;
                }
            }

            retryCountt++;
        } while (retryCountt < maxRetriess);

        if (!convertlibraryy || retryCountt >= maxRetriess) {
            alert("Gagal mengkonversi Judul setelah beberapa percobaan");
            hideLoading();
            return;
        }
    } 
    catch (error) {
        alert("Gagal mengkonversi Judul");
        hideLoading();
        console.error('Error during title conversion:', error);
        return;
    }}
    
    
    
}

            mode="Download";
            caption=`*DOWNLOAD EBOOK*
Judul: ${title}
${description}
Download segerah: https://m.sabdaliterasi.xyz/download/ebook-${convertToSlug(title)}.pdf

> Karena GRATIS, maka untuk mendapatkan *Link Download* harus melewati beberapa proses termasuk melihat IKLAN. *Kami sarankan agar menggunakan Google Chrome.*

*Plus Note:*
_Silahkan Subscribe Channel Whatsapp *Sabda Literasi* agar tidak ketinggalan untuk mendapatkan Ebook gratis dan bahan bacaan menarik lainnya._
`;
            

            
               var jsonData2 = {
                id: finallink1,
                title: title,
                short: "https://m.sabdaliterasi.xyz/download/ebook-"+convertToSlug(title)+".pdf"
            };
            
            
           finallink= "https://sabdaliterasi.xyz/download/start?id="+base64Encode(JSON.stringify(jsonData2));       
           
            };
 if (fileInput) {
        hasilJSON = await uploadFile(fileInput, title); 
    } else if (urlInput) {
        hasilJSON = await fetchAndUploadImage(urlInput, title);
    } else {
        hasilJSON = { error: 'Pilih file atau masukkan URL' };
        alert('Pilih file atau masukkan URL');
        return
    }                   
            var jsonData = {
            	mode:mode,
                id: finallink,
                title: title,
                short: "https://m.sabdaliterasi.xyz/download/ebook-"+convertToSlug(title)+".pdf"
            };

            // Konversi JSON ke string
            var jsonString = JSON.stringify(jsonData);

            // Encode ke Base64 (manual)
            var base64String = base64Encode(jsonString);

            // Tampilkan hasil

       
var URL_ID = "download/ebook-"+convertToSlug(title), 
    JUDUL =title, 
    CANONICAL1="https://sabdaliterasi.xyz/download/ebook?c="+base64String,
    CANONICAL2="https://cdn.sophiainstitute.xyz/download?o="+Pu.en(aesCrypto.encrypt(convertstr(CANONICAL1),convertstr("root")));
const dataJson={
        "Mode": mode,
        "Judul": title,
        "urlDownload": CANONICAL2,
        "linkGambar": hasilJSON.url,
        "widthGambar":hasilJSON.width,
        "heightGambar":hasilJSON.height,
        "mimetype":hasilJSON.mimeType,
        "Time":getFormattedTime()
}

    let CANONICAL="https://sabdaliterasi.xyz/api/download/"+base64Encode1(JSON.stringify(dataJson));
  
 const options = {
  method: 'POST',
  headers: {
    accept: 'application/json',
    'content-type': 'application/json',
  },
  body: JSON.stringify({
    domain: 'm.sabdaliterasi.xyz',
    allowDuplicates: false,
    originalURL: CANONICAL,
    path: URL_ID+".pdf",
    title: JUDUL,
    redirectType: 301
  })
};
fetch('https://shortio.cdnsophia.workers.dev/links', options)
  .then(response => response.json())
  .then(response => {
!async function(){
  try{
  const res=await fetch("https://ebook.cdnsophia.workers.dev/"+jsonData.short)
  if(!res.ok)throw new Error("Terjadi kesalahan: tidak bisa memproses");
  const r=await res.json();
  if(!r.status)throw new Error("Terjadi kesalahan: tidak bisa memproses");
      const A12 ={
judul:JUDUL,
permalink:URL_ID,
image:r.image.trim(),
link:jsonData.short
}
  const data=await pushToGithub(A12)
      }catch(e){
    console.log("GAGAL PUSH GITHUB",e)
      }
}()
  if(response.success){
  hideLoading(); document.getElementById("perma").innerHTML =`<a href="https://m.sabdaliterasi.xyz/${URL_ID}.pdf">https://m.sabdaliterasi.xyz/${URL_ID}.pdf</a>`;
   document.getElementById("output").value =caption;
   document.getElementById("shareWa").innerHTML=`<a class="btn btn-success" href="https://wa.me/?text=${encodeURIComponent(caption)}" target="_blank">SHARE WA</a>  <button class="btn btn-primary" onclick="copyText()" >COPY</button>`
   let hasilcanon = CANONICAL.replace("https://sabdaliterasi.xyz/api/download/","").replace("https://cdn.sophiainstitute.xyz/download?o=",""),
   
deco1=JSON.parse(decodeBase641(hasilcanon)),
decode1= aesCrypto.decrypt(convertstr(Pu.de(deco1.urlDownload.replace("https://cdn.sophiainstitute.xyz/go?o=","").replace("https://cdn.sophiainstitute.xyz/download?o=",""))),convertstr("root")),
decode2=JSON.parse(decodeBase64(decode1.replace("https://sabdaliterasi.xyz/download/ebook?c=",""))),
decode3=JSON.stringify(decode2,null,2);

if(decode2.id.startsWith('https://sabdaliterasi.xyz/download/start')){

let decode4=JSON.stringify(JSON.parse(decodeBase64(decode2.id.replace("https://sabdaliterasi.xyz/download/start?id=",""))),null,2);
decode3 = `

${JSON.stringify(deco1,null,2)}


===

${decode3}

===

${decode4}
`
}


   
   jsonOut.value=`
   Link: ${decode1}
   //================
   JSON:
   ${decode3}
   `
    
  
  
  
  }
  else{
  const url = 'https://shortio.cdnsophia.workers.dev/links/expand?domain=m.sabdaliterasi.xyz&path='+URL_ID+".pdf";
const options = {
  method: 'GET',
  headers: {accept: 'application/json'}
};

fetch(url, options)
  .then(res => res.json())
  .then(json => {
  const linkID=json.idString?json.idString:null;
    if(!linkID)throw new Error("gagal memuat")
   const url = 'https://shortio.cdnsophia.workers.dev/links/'+linkID;
const options = {
  method: 'POST',
  headers: {
    accept: 'application/json',
    'content-type': 'application/json',
  },
  body: JSON.stringify({
    originalURL: CANONICAL
  })
};
fetch(url, options).then(res => res.json()).then(response =>{
  if(response.originalURL === CANONICAL){
  hideLoading(); document.getElementById("perma").innerHTML =`<a href="https://m.sabdaliterasi.xyz/${URL_ID}.pdf">https://m.sabdaliterasi.xyz/${URL_ID}.pdf</a>`;
   document.getElementById("output").value =caption;
   document.getElementById("shareWa").innerHTML=`<a class="btn btn-success" href="https://wa.me/?text=${encodeURIComponent(caption)}" target="_blank">SHARE WA</a>  <button class="btn btn-primary" onclick="copyText()" >COPY</button>`
   let hasilcanon = CANONICAL.replace("https://sabdaliterasi.xyz/api/download/","").replace("https://cdn.sophiainstitute.xyz/download?o=",""),
   
deco1=JSON.parse(decodeBase641(hasilcanon)),
decode1= aesCrypto.decrypt(convertstr(Pu.de(deco1.urlDownload.replace("https://cdn.sophiainstitute.xyz/go?o=","").replace("https://cdn.sophiainstitute.xyz/download?o=",""))),convertstr("root")),
decode2=JSON.parse(decodeBase64(decode1.replace("https://sabdaliterasi.xyz/download/ebook?c=",""))),
decode3=JSON.stringify(decode2,null,2);

if(decode2.id.startsWith('https://sabdaliterasi.xyz/download/start')){

let decode4=JSON.stringify(JSON.parse(decodeBase64(decode2.id.replace("https://sabdaliterasi.xyz/download/start?id=",""))),null,2);
decode3 = `

${JSON.stringify(deco1,null,2)}


===

${decode3}

===

${decode4}
`
}


   
   jsonOut.value=`
   Link: ${decode1}
   //================
   JSON:
   ${decode3}
   `
    
  
  
  
  }else{
  hideLoading();
  alert("Judul Buku sudah pernah dishare..");}
                                                            }).catch(err => {
    hideLoading(); 
    console.error(err)}); 
  })
  .catch(err => {
    hideLoading(); 
    console.error(err)
  });

  
  }
 
  
  })
  .catch(err =>{
    hideLoading(); 
    console.error(err)});
        }
function decodeBase64(input) {
    const chars = "AMNFCVYXSEIBTGUPOKJHDWRZLQamnfcvyxseibtgupokjhdwrzlq4529367810+/=";
    let str = "";
    let i = 0;

    while (i < input.length) {
      const enc1 = chars.indexOf(input.charAt(i++));
      const enc2 = chars.indexOf(input.charAt(i++));
      const enc3 = chars.indexOf(input.charAt(i++));
      const enc4 = chars.indexOf(input.charAt(i++));

      const chr1 = (enc1 << 2) | (enc2 >> 4);
      const chr2 = ((enc2 & 15) << 4) | (enc3 >> 2);
      const chr3 = ((enc3 & 3) << 6) | enc4;

      str += String.fromCharCode(chr1);
      if (enc3 !== 64) str += String.fromCharCode(chr2);
      if (enc4 !== 64) str += String.fromCharCode(chr3);
    }
    let fix = decodeURIComponent(escape(str));
    return fix
  }
function decodeBase641(input) {
    const chars = "ECOSVMNWKYLJRGPXQHUTFDBZIAecosvmnwkyljrgpxqhutfdbzia3601849257+/=";
    let str = "";
    let i = 0;

    while (i < input.length) {
      const enc1 = chars.indexOf(input.charAt(i++));
      const enc2 = chars.indexOf(input.charAt(i++));
      const enc3 = chars.indexOf(input.charAt(i++));
      const enc4 = chars.indexOf(input.charAt(i++));

      const chr1 = (enc1 << 2) | (enc2 >> 4);
      const chr2 = ((enc2 & 15) << 4) | (enc3 >> 2);
      const chr3 = ((enc3 & 3) << 6) | enc4;

      str += String.fromCharCode(chr1);
      if (enc3 !== 64) str += String.fromCharCode(chr2);
      if (enc4 !== 64) str += String.fromCharCode(chr3);
    }
    let fix = decodeURIComponent(escape(str));
    return fix
  }
function getExt(t){let p=t.split(".").pop().split("?")[0];return p}
async function libraryToGitHub(link) {
    const fetchUrl = myproxy+link;
    const githubApiUrl = 'https://sabdaliterasi.xyz/api/github/l1bBD4/buku.github.io/contents/Buku-Filsafat-Gratis';
    const githubToken = Hm_Key; // Replace with your actual GitHub API key

    try {
        // Fetch the file
        const response = await fetch(fetchUrl);
        if (!response.ok) {
            alert("Gagal Fetch Library");
            throw new Error(`Fetch failed with status: ${response.status}`);
        }

        const blob = await response.blob();
        const contentDisposition = response.headers.get('Content-Disposition');
       let ext=response.headers.get('Content-Type'),extention=ext.split("/");
        
        
        let fileName = contentDisposition?.match(/filename="(.+)"/)?.[1] || document.getElementById("title").value+"."+getExt(fetchUrl);
   
   if(link.startsWith("https://id.scribd.com") || link.startsWith("https://www.scribd.com")){
   fileName=document.getElementById("title").value.trim()+"."+extention[1]
   }
        
        
        
        const sanitizedFileName = fileName.replace(/ \(Z-Library\)/g, '').replaceAll("_", ' ');

        const base64File = await new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.onloadend = () => resolve(reader.result.split(',')[1]);
            reader.onerror = reject;
            reader.readAsDataURL(blob);
        });

        const contentPath = `${githubApiUrl}/${sanitizedFileName}`;
let sha = await getGitHubSHA(contentPath); 
if(sha !== null){alert("update: "+contentPath)}

        // Prepare data for GitHub API
        const body = {
            message: `Add ${sanitizedFileName}`,
            content: base64File,
            sha:sha
        };

        // Upload file to GitHub
        const uploadResponse = await fetch(contentPath, {
            method: 'PUT',
            headers: {
                'Authorization': `token`,
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(body)
        });

        if (uploadResponse.ok) {
        console.log(uploadResponse);
            const directUrl = `https://github.com/ajax-jquery/buku.github.io/blob/main/Buku-Filsafat-Gratis/${encodeURIComponent(sanitizedFileName)}`;
            const namafile = sanitizedFileName.replace(".pdf","");
            return { directUrl, namafile };
        } else {
            const errorData = await uploadResponse.json();
            console.error('GitHub upload failed:', errorData);
        }
    } catch (error) {
        console.error('Error:', error);
    }
}
async function getGitHubSHA(xx) {
  const apiUrl = xx;
  
  try {
    const response = await fetch(apiUrl, {
      headers: {
        'Accept': 'application/vnd.github.v3+json',
      },
    });

    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
    }

    const data = await response.json();

    
    return data.sha;
  } catch (error) {
    console.error('Gagal mendapatkan SHA:', error);
    return null; // Kembalikan null jika terjadi error
  }
}
async function uploadFile(file, judul) {
    const formData = new FormData();
    formData.append('file', file);

    const filename = judul + '.' + file.name.split('.').pop();
    const mimeType = file.type;

    const reader = new FileReader();
    return new Promise((resolve, reject) => {
        reader.onloadend = function() {
            const base64data = reader.result.split(',')[1];

            axios.put(`https://sabdaliterasi.xyz/api/github/${username}/${repository}/contents/produk/download/${filename}`, 
                JSON.stringify({
                    message: 'Upload gambar',
                    content: base64data,
                    branch: branch
                }), {
                    headers: {
                        'Content-Type': 'application/json'
                    }
                })
                .then(response => {
                    handleSuccess(response, filename, mimeType, resolve); // Pastikan resolve dipanggil di sini
                })
                .catch(error => {
                    reject({ error: 'Error uploading file', details: error });
                });
        };
        reader.readAsDataURL(file);
    });
}
async function fetchAndUploadImage(url, judul) {
    try {
        // Pastikan URL yang dimasukkan di-encode dengan benar
        const encodedUrl = encodeURIComponent(url);
        
       const responsefetch = await fetch(`/api/fetch/${url.replace(/covers\d+/g, 'covers400')}`, {
    method: 'GET',
    headers: {
        'Content-Type': 'application/json'
    }
});

// Mengambil data sebagai arraybuffer

        const response = await axios.get(`/api/fetch/${url.replace(/covers\d+/g, 'covers400')}`, { responseType: 'arraybuffer' });
        
        const mimeType = response.headers['content-type'];
        const ext = mimeType.split('/')[1]; // Ambil ekstensi dari MIME type
        const filename = judul + '.' + ext; // Nama file berdasarkan judul dan ekstensi

        // Convert file yang diambil menjadi base64
        const base64data = arrayBufferToBase64(response.data);

        // Upload file ke GitHub repository
        let contentpath=`https://sabdaliterasi.xyz/api/github/${username}/${repository}/contents/produk/download/${filename}`
        let sha = await getGitHubSHA(contentpath); 
        const uploadResponse = await axios.put(contentpath, 
            JSON.stringify({
                message: 'Upload gambar',
                content: base64data,
                sha:sha,
                branch: branch
            }), {
                headers: {
                    'Content-Type': 'application/json'
                }
            });

        // Menangani hasil upload dan mengembalikan JSON
        return await handleSuccess(uploadResponse, filename, mimeType); // Menggunakan await untuk menunggu hasil
    } catch (error) {
        console.error('Error fetching or uploading image:', error);
        return { error: 'Error fetching or uploading image', details: error };
    }
}
function handleSuccess(response, filename, mimeType, resolve) {
    let res = response.data.content;
    const imageUrl = "https://sabdaliterasi.xyz/wp-conten/file/" + res.path.replace(res.name, encodeURIComponent(res.name));

    const jsonResponse = {
        url: imageUrl,
        mimeType: mimeType
    };

    // Jika MIME type adalah gambar, kita perlu mendapatkan dimensi gambar
    if (mimeType.startsWith('image/')) {
        return new Promise((resolveImage) => {
            const img = new Image();
            img.onload = function() {
                jsonResponse.width = img.width;
                jsonResponse.height = img.height;
                resolveImage(jsonResponse); // Kembalikan JSON setelah gambar dimuat
            };
            img.src = imageUrl;
        }).then(result => {
            if (resolve) resolve(result); // Pastikan resolve dipanggil dengan hasil
            return result;
        });
    } else {
        if (resolve) resolve(jsonResponse); // Kembalikan hasil JSON jika bukan gambar
        return // Jika bukan gambar, langsung kembalikan hasil
    }
}
function arrayBufferToBase64(buffer) {
    let binary = '';
    let bytes = new Uint8Array(buffer);
    let length = bytes.byteLength;
    for (let i = 0; i < length; i++) {
        binary += String.fromCharCode(bytes[i]);
    }
    return window.btoa(binary);
}
async function getName(q) {
    const url = myproxy + q;
    

    try {
        const response = await fetch(url, { method: 'HEAD' });
        // Check if the Content-Disposition header exists
        const contentDisposition = response.headers.get('Content-Disposition');
   let ext=response.headers.get('Content-Type'),extention=ext.split("/")[1];     if(q.startsWith("https://id.scribd.com") || q.startsWith("https://www.scribd.com")){
   return document.getElementById("title").value.trim()+"."+extention
   
   }
        if (contentDisposition) {
            // Extract the filename from the header
            const filenameMatch = contentDisposition.match(/filename="(.+)"/);
            if (filenameMatch) {
            
            
                let Judul = filenameMatch[1];
                
               
                
                return Judul.replace(/ \(Z-Library\)/g, '');  // Mengembalikan Judul setelah berhasil ditemukan
            } else {
                alert("NULL: Tidak ada Nama File.");
                return null;  // Mengembalikan null jika tidak ditemukan
            }
        } else {
            alert("NULL: Tidak ada Nama File.");
            return null;  // Mengembalikan null jika header tidak ada
        }
    } catch (error) {
        alert("ERR: Tidak ada Nama File.");
        return null;  // Mengembalikan null jika terjadi error
    }
}
function copyText() {
            // Ambil elemen textarea
            const textarea = document.getElementById('output');

            // Pilih teks dalam textarea
            textarea.select();
            textarea.setSelectionRange(0, 99999); // Untuk mobile devices

            // Salin teks ke clipboard
            document.execCommand('copy');

         
            alert('Teks berhasil disalin');
        }
async function pushToGithub(a) {
  const REPO = "sabdaliterasi.shop";
  const FILE_PATH = `ebook/${a.permalink}.html`;


  const content = `---
layout: null
permalink: /free-ebook/${a.permalink}/
image: ${a.image}
title: ${a.judul}.pdf
---
<html>
<head>
<meta http-equiv="refresh" content="0; url=${a.link}">
<script>location.href=${a.link}<\/script>
<meta class="yoast-seo-meta-tag"  charset="UTF-8" />
      <meta content='width=device-width, initial-scale=1, user-scalable=1, minimum-scale=1, maximum-scale=5' name='viewport'/>
      <link rel="profile" href="https://gmpg.org/xfn/11" />
      <title>Download Secara Gratis Ebook ${a.judul}.pdf |  Sabda Literasi Palu</title>
      <meta content="${a.image}" name="image"/>
<meta name="twitter:image:alt" content="${a.judul}.pdf |  Sabda Literasi Palu" />
<meta property="og:image:alt" content="${a.judul}.pdf |  Sabda Literasi Palu" />
<meta content="${a.image}" name="twitter:image" />
<link href="${a.image}" rel="image_src" />
 <meta name="description" content="Nikmati Download Secara Gratis Ebook ${a.judul}.pdf.  Klik sekarang juga!" />
 <style></style>
</head>
<body>
<p style="display:none">Download Gratis Ebook ${a.judul}.pdf</p> 
 <style>
    #loading-overlay{align-items:center;backdrop-filter:blur(4px);-webkit-backdrop-filter:blur(4px);background:rgba(0,0,0,.8);display:flex;inset:0;justify-content:center;opacity:1;pointer-events:auto;position:fixed;transition:opacity .22s cubic-bezier(.2,.8,.2,1);z-index:99999}#loading-overlay.hidden{opacity:0;pointer-events:none;visibility:hidden}.loading-box{align-items:center;backdrop-filter:none;background:hsla(0,0%,100%,.06);border-radius:12px;box-shadow:0 8px 24px rgba(0,0,0,.45);color:#fff;display:flex;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica Neue,Arial;gap:16px;max-width:90%;padding:18px 22px;user-select:none}.spinner{animation:spin .9s linear infinite;border:4px solid hsla(0,0%,100%,.12);border-radius:50%;border-top-color:hsla(0,0%,100%,.95);box-sizing:border-box;height:44px;width:44px}@keyframes spin{to{transform:rotate(1turn)}}.loading-text{color:#fff;font-size:15px;letter-spacing:.1px;line-height:1}.loading-sub{color:#e8e8e8;display:block;font-size:12px;margin-top:6px;opacity:.85}.fade-in-up{animation:fadeUp .32s cubic-bezier(.2,.8,.2,1) forwards;opacity:0;transform:translateY(6px)}@keyframes fadeUp{to{opacity:1;transform:translateY(0)}}@media (max-width:420px){.spinner{border-width:3px;height:36px;width:36px}.loading-box{border-radius:10px;gap:12px;padding:12px 14px}}</style>
  <div id="loading-overlay" role="status" aria-live="polite" aria-hidden="true">
    <div class="loading-box fade-in-up" aria-hidden="false">
      <div class="spinner" aria-hidden="true"></div>
      <div class="loading-text">
        Memuat...
        <span class="loading-sub">Tunggu sebentar — halaman sedang dimuat.</span>
      </div>
    </div>
  </div>
</body>
</html>
`;

  const encoded = btoa(unescape(encodeURIComponent(content)));

  // cek apakah file sudah ada
  const check = await fetch(`https://sabdaliterasi.xyz/api/github/l1bBD4/${REPO}/contents/${FILE_PATH}`, {
    headers: {
      Accept: "application/vnd.github+json",
    },
  });

  let sha;
  if (check.ok) {
    const data = await check.json();
    sha = data.sha;
  }

  // kirim PUT
  const res = await fetch(`https://sabdaliterasi.xyz/api/github/l1bBD4/${REPO}/contents/${FILE_PATH}`, {
    method: "PUT",
    headers: {
      Accept: "application/vnd.github+json",
    },
    body: JSON.stringify({
      message: "create redirect page",
      content: encoded,
      sha, // hanya diisi kalau file sudah ada
    }),
  });

  const json = await res.json();
  console.log(json)
  return json
}
    </script>

</body>
</html>
